## Attempt our own cleaning up of data here.


```{r, echo = FALSE}
# Load the raw stock trading data
stockTradingDataKmeans <- read.csv("/Users/gafei/Documents/school/CIS600/final/raw_data/us-historical-stock-prices-with-earnings-data/stocks_latest/stock_prices_latest.csv")
```

```{r}
# lets look at the data briefly
str(stockTradingDataKmeans)
```

```{r}
# remove the split coefficient column
stockTradingDataKmeans <-stockTradingDataKmeans[, -c(9)]
```

```{r}
# change the date column to be in "date" format
stockTradingDataKmeans$date <- as.Date(stockTradingDataKmeans$date)
```

```{r, echo = FALSE}
# lets filter by stocks in 2018.
stockTradingDataKmeans2018 <- stockTradingDataKmeans[stockTradingDataKmeans$date >= "2018-01-01" & stockTradingDataKmeans$date <= "2018-12-31",]
```

```{r, echo = FALSE}
#factor the 7091 stocks into numbers
stockTradingDataKmeans2018$symbol <- factor(stockTradingDataKmeans2018$symbol)
```

```{r, echo = FALSE}
# remove any rows that have 0 volume, that means there weren't any price changes
test <- filter(stockTradingDataKmeans2018, volume != 0)
```

```{r, echo = FALSE}
# remove any columns that we don't care about, in this case, we removed 
testCloseAdj <- test[, -c(3:6,8)]
```

```{r, echo = FALSE}
# reshapes stocks to have stock symbol, then date1, then date 2, etc...
reshapeStocks <-dcast(testCloseAdj, symbol ~ date, value.var = "close_adjusted" )
```

```{r, echo = FALSE}
# reshapes stocks to have date, symbol1, symbol2, symbol3, etc... in order of date.
reshapeStocks2 <-dcast(testCloseAdj, date ~ symbol, value.var = "close_adjusted" )
```

```{r, echo = FALSE}
#move date column to rows
reshapeStocks2daterow <-column_to_rownames(reshapeStocks2, loc=1)
```

```{r, echo = FALSE}
#kmeans preprocessing, scale the data
reshapeStocks2daterowscaled <- scale(reshapeStocks2daterow[c(1:5186)])
```

```{r, echo = FALSE}
# kmeans preprocessing, remove all columns that have at least one NA
testna1 <- t(na.omit(t(reshapeStocks2daterowscaled )))
```

```{r}
# lets figure out the optimal amount of clusters for dataset
fviz_nbclust(testna1, kmeans, method = "wss", k.max = 8)
```

```{r, echo = FALSE}
#k means analysis, but omit anything that is na
kmeansStocks2018 <-kmeans(testna1, centers = 4, iter.max = 10000)
```

```{r}
# shows an aggregate of stock movement, based on trading day
fviz_cluster(kmeansStocks2018, data = testna1)
```

```{r, echo = FALSE}
#k means analysis, with center of 8
kmeansStocks2018_8 <-kmeans(testna1, centers = 8, iter.max = 10000)
```

```{r}
# shows an aggregate of stock movement, based on trading day
fviz_cluster(kmeansStocks2018_8, data = testna1)
```




## Lets calcuate annual returns here? How should we select stocks for annual returns?




## Calculate returns based on earnings data? Generally, there's higher volatility during "earnings" season. Q1, Q2, Q3, Q4?



<!---
#
# elbow curve to determine k number?

#annualReturn <- 

# kmeans preprocessing, remove date column
reshapeStocks2noDate <- reshapeStocks2[, -c(1)]

#kmeans preprocessing, scale the data
reshapeStocks2noDatescaled <- scale(reshapeStocks2noDate[c(1:5186)])

# kmeans preprocessing, omit NAs.
#reshapeStocks2noDatescalednoNA <- na.omit(reshapeStocks2noDatescaled)

# kmeans preprocessing, remove all columns that have at least one NA
testna <- t(na.omit(t(reshapeStocks2noDatescaled )))

#kmeans preprocessing, scale the data
#testnascale <- scale(testna[c(1:5186)])


#k means analysis, but omit anything that is na
kmeansStocks2017_2 <-kmeans(testna centers = 4, iter.max = 10000)

# shows a visual by trading day? (1-252)?
fviz_cluster(kmeansStocks2017_2, data = testna)


#standardize the continuous numbers, and only the columns that have numbers that we care about
stockTradingDataKmeans2017Scaled <- scale(test[c('open','high', 'low', 'close', 'close_adjusted', 'volume')])


#elbow method to figure out how many k's
#fviz_nbclust(stockTradingDataKmeans2017Scaled, kmeans, method = "wss", k.max = 8)


## K means Clustering? K is 4 here.

Play with your k value here to modify the clustering analysis.
This is our model for playing around with different type of data.

kmeansStocks2017 <- kmeans(stockTradingDataKmeans2017Scaled, centers = 4, iter.max = 10000)

#lets look at centers
kmeansStocks2017$centers


# Lets see what our output is
# this takes more than an hour to generate!
fviz_cluster(kmeansStocks2017, data = stockTradingDataKmeans2017Scaled)
--> 
















